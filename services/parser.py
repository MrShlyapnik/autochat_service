from .table import table
import openpyxl
import requests
def parser(message, phone,wb):
    # f=open('text.txt', encoding="utf-8")
    # text=f.read()
    # f.close()
    text=message
    months=['—è–Ω–≤–∞—Ä—å','—Ñ–µ–≤—Ä–∞–ª—å','–º–∞—Ä—Ç','–∞–ø—Ä–µ–ª—å','–º–∞–π',
        '–∏—é–Ω—å','–∏—é–ª—å','–∞–≤–≥—É—Å—Ç','—Å–µ–Ω—Ç—è–±—Ä—å',
        '–æ–∫—Ç—è–±—Ä—å','–Ω–æ—è–±—Ä—å','–¥–µ–∫–∞–±—Ä—å',
    ]
    message=text.lower()
    for m in months:
        message=message.replace(m, ' ' +m+' ')
    message=message.replace("-", "")
    message=message.replace("–ó–∞–Ω—è—Ç—ã–µ –¥–∞—Ç—ã", " ")
    message=message.replace("–ó–∞–Ω—è—Ç—ã–µ –¥–∞—Ç—ã!", " ")
    message=message.replace("–∑–∞–Ω—è—Ç—ã–µ –¥–∞—Ç—ã!", " ")
    message=message.replace("!", " ") 
    message=message.replace(";", " ")
    message=message.replace(".", "")
    message=message.replace("üè°", ' ')
    message=message.replace("‚úÖ", ' ')
    message=message.replace("‚õî", ' ')
    message=message.replace("üß∏", ' ')
    message=message.replace("üî•", ' ')
    message=message.replace("\n", " ")
    message=message.replace(":", " ")
    message=message.replace(",", " ")
    message=message.replace("(", " ")
    message=message.replace(")", " ")
    message=message.replace("     ", " ")
    message=message.replace("    ", " ")
    message=message.replace("   ", " ")
    message=message.replace("  ", " ")
    message=message.replace("*", " ")
    new_formating_message=""
    info={
    '79053116753':
    {
        '–¥–æ–º–±–æ–≥–æ—Ä–æ–¥—Å–∫–æ–µ':{},
            '–¥–æ–º—à–∞–ø—à–∏':{},
    },
    '79063257387':
    {
        '–º–∞–ª—ã–π':{},
        '–±–æ–ª—å—à–æ–π':{},
    },
    '79600363975':
    {
        '–∑–µ–ª–µ–Ω—ã–π–º–∏–Ω–¥–∞–ª—å':{},
        '—Å–∞–ª–º–∞—á–∏':{},
    },
    '79377771034':
    {
        '–¥–µ—Ä–µ–≤—è–Ω–Ω—ã–π':{},
        '–∫–∏—Ä–ø–∏—á–Ω—ã–π':{},
    },
    '79047619866':
    {
        '–∑–∞–º–æ–∫':{},
        '—Å—Ä—É–±':{},
        '–¥–≤–æ—Ä–µ—Ü':{},
    },
    '79656012318':
    {
        '–±–∞–≤–∞—Ä–∏—è':{},
        
        '–ø–∞–Ω–æ—Ä–∞–º–∞':{},
    },
    '79872711910':
    {
        '–∫–æ–Ωc—Ç–∞–Ω—Ç–∏–Ω–æ–≤–∫–∞':{},
    },
    '79510675675':
    {
        '–ø—É–ª–∏—Ö–∞':{}
    },
    '79872974084':
    {
        '–∞–º–∞–ª—ã–π':{},
        '–±—Å—Ä–µ–¥–Ω–∏–π':{},
        '–≤–±–æ–ª—å—à–æ–π':{},
    },
    '79274226911':
    {
        '—á–∞–π–∫–∞1':{},
        '—á–∞–π–∫–∞2':{},
    },
    '79050212617':
    {
        '–¥–æ–º':{},
        '—Ä—É—Å—Å–∫–∞—è':{},
        '–æ—Ö–æ—Ç–Ω–∏—á—å—è':{},
        '–±–µ—Ä–µ–≥':{},
        '–ø–∞—Ä–∫':{},
    },
    '79196237446':
    {
        "greenland":{}
    },
    '79600482261':
    {
        '—á–µ—Ä–µ–º—à–∞–Ω–æ–≤–∞—è23':{}
    },
    '79377772077':
    {
        '–∫–∞–ª–∏–Ω–∏–Ω–æ':{}
    },
    '79274180728':
    {
        '–ø—Ä–∏–≤–æ–ª—å–Ω—ã–π':{}
    },
    '79600323247':
    {
        "–º–∞–ª56":{},
        "–º–∞–ª–±–∞—Å60":{},
        "–±–æ–ª—å—à58":{},
        "—Å—Ä–µ–¥54":{},
        "–Ω–æ–≤—ã–π66":{},
        "–Ω–æ–≤66":{},

    },
    '79172290723':
    {
        "–¥–∞—á–Ω–∞—è128":{}
    },
    '79196224788':
    {
        '–º–∏—Ä–∞141':{}
    },
    '79178670299':
    {
        '–∞':{},
        '–±':{},
        '–≤':{},
        '–≥':{},
    },
    '79600421404':
    {
        '–æ—Å–∏–Ω–æ–≤–æ':{}
    },
    '79867124227':
    {
        '–æ—Ç–∞—Ä—ã2':{}
    },
    '79510675675':
    {
        '—Å–≤—É—Å–∞–¥—å–±':{}
    },
    '79274358985':
    {
        '–±–µ–ª–æ–º–æ—Ä—Å–∫–∞—è54':{}
    },
    '79625515760':
    {
        'premium':{}
    },
    '79872971476-1481554579@g.us':
    {
        '–∫1':{},
            '–∫3':{},
            '–∫4':{},
    },
    '79178767741-1419363809@g.us':
    {
        '–±–∞–Ω–∫–µ—Ç–Ω—ã–π–∑–∞–ª':{},
        '1—Ä—ã—Ü–∞—Ä—Å–∫–∏–π':{},
            '2vip':{},
            '3–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π':{},
            '4–≤–æ—Å—Ç–æ—á–Ω—ã–π1':{},
            '5–≤–æ—Å—Ç–æ—á–Ω—ã–π2':{},
            '6—è–ø–æ–Ω—Å–∫–∏–π':{},
            '7–≥–æ—Å—Ç–µ–≤–æ–π':{},
            '8–∫–∞–∑–∞–Ω–∫–∞':{},

    },
    '79655807679-1585037693@g.us':
    {
        '—Ü–∞—Ä—Å–∫–∏–π':{},
            '—Å–æ—Å–Ω–æ–≤—ã–π':{},
            '–ø–∞–Ω–æ—Ä–∞–º–∞':{},
            '–∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã':{},
             '–¥—è—Ç–ª–æ–≤–æ':{},
    },
    '79655888066-1485072828@g.us':
    {
        '3–Ω–æ–≤—ã–π':{},
        '–º–∞–ª—ã–π':{},
            '–±–æ–ª—å—à–æ–π':{},
    },
    '79655896555-1527783737@g.us':
    {
        '–º–∞–ª—ã–π':{},
            '–±–æ–ª—å—à–æ–π':{},
    },
    '79046764175-1568197083@g.us':
    {
        '–ª–∏—Ç–≤–∏–Ω–æ–≤–∞1–∞':{}
    },
    '79172591019-1564744795@g.us':
    {
        '–Ω–∞–±–µ—Ä–µ–∂–Ω–∞—è3':{},
        '–Ω–∞–≥–æ—Ä–µ/141':{},
        '–Ω–∞–±–µ—Ä–µ–∂–Ω–∞—è4':{},
    },
    '79046764175-1528129775@g.us':
    {
        '—É—Ç—Ä–µ–Ω–Ω—è—è8–∞':{}
    },
    '79520308800-1503831959@g.us':
    {
        '–º–∏—á—É—Ä–∏–Ω–∞117':{}
    },
    '79872360002-1599913260@g.us':
    {
        '–ª–æ–∫–æ–º–æ—Ç–∏–≤':{}
    },
    '79600510471-1579437045@g.us':
    {
        '–æ—Ç–∞—Ä—ã3':{}
    },
    '79172998115-1568958489@g.us':
    {
        '–ø–µ—Ç—Ä–æ–≤—Å–∫–∏–π':{}
    },
    '79270394387-1557135797@g.us':
    {
        '—Å–∞–ª–º–∞—á–∏5':{}
    },
    '79046764175-1569163276@g.us':
    {
        '–±–∞—Ä—Å–∫–∏–π':{}
    },
    }
    # info={
        
    #         '–¥–æ–º–±—Ä–æ–≥–æ—Ä–æ–¥—Å–∫–æ–µ':{},
    #         '–¥–æ–º—à–∞–ø—à–∏':{},
    #         '–¥—è—Ç–ª–æ–≤–æ':{},
    #         '–Ω–∞–±–µ—Ä–µ–∂–Ω–∞—è3':{},
    #         '–Ω–∞–≥–æ—Ä–µ/141':{},
    #         '–Ω–∞–±–µ—Ä–µ–∂–Ω–∞—è4':{},
    #         '–º–∞–ª—ã–π':{},
    #         '–±–æ–ª—å—à–æ–π':{},
    #         '–∑–µ–ª–µ–Ω—ã–π–º–∏–Ω–¥–∞–ª—å':{},
    #         '–¥–µ—Ä–µ–≤—è–Ω–Ω—ã–π':{},
    #         '–∫–∏—Ä–ø–∏—á–Ω—ã–π':{},
    #         '–∑–∞–º–æ–∫':{},
    #         '—Å—Ä—É–±':{},
    #         '–¥–≤–æ—Ä–µ—Ü':{},
    #         '—Ü–∞—Ä—Å–∫–∏–π':{},
    #         '—Å–æ—Å–Ω–æ–≤—ã–π':{},
    #         '–ø–∞–Ω–æ—Ä–∞–º–∞':{},
    #         '–∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã':{},
    #         '–±–∞–≤–∞—Ä–∏—è':{},
    #         '–∫–æ–Ω—Ç—Å–∞–Ω—Ç–∏–Ω–æ–≤–∫–∞':{},
    #         '–∫1':{},
    #         '–∫3':{},
    #         '–∫4':{},
    #         '–¥–æ–º':{},
    #         '—Ä—É—Å—Å–∫–∞—è':{},
    #         '–æ—Ö–æ—Ç–Ω–∏—á—å—è':{},
    #         '–±–µ—Ä–µ–≥':{},
    #         '–ø–∞—Ä–∫':{},
    #         '–∫–æ—â–∞–∫–æ–≤–æ':{},
    #         '–∑–∞–Ω—è—Ç–æ':{},
    #         '8–∫–∞–∑–∞–Ω–∫–∞':{},
    #         '–±–∞–Ω–∫–µ—Ç–Ω—ã–π–∑–∞–ª':{},
    #         '1—Ä—ã—Ü–∞—Ä—Å–∫–∏–π':{},
    #         '2vip':{},
    #         '3–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π':{},
    #         '4–≤–æ—Å—Ç–æ—á–Ω—ã–π1':{},
    #         '5–≤–æ—Å—Ç–æ—á–Ω—ã–π2':{},
    #         '6—è–ø–æ–Ω—Å–∫–∏–π':{},
    #         '7–≥–æ—Å—Ç–µ–≤–æ–π':{},
    #         '–∞':{},
    #         '–±':{},
    #         '–≤':{},
    #         '–≥':{},
    #         '—Å–∞–ª–º–∞—á–∏':{},
    #         '–Ω–æ–≤—ã–π':{},
    #         '–º–∞–ª':{},
    #         '–º–∞–ª–±–∞—Å':{},
    #         '—Å—Ä–µ–¥':{},
    #         '–±–æ–ª—å—à':{},
    #         '–∞–º–∞–ª—ã–π':{},
    #         '–±—Å—Ä–µ–¥–Ω–∏–π':{},
    #         '–≤–±–æ–ª—å—à–æ–π':{},
    #         '—á–∞–π–∫–∞1':{},
    #         '—á–∞–π–∫–∞2':{},

    #     }

    info1={
            '—á–µ—Ä–µ–º—à–∞–Ω–æ–≤–∞—è 23':{},
            '–¥–æ–º –±–æ–≥–æ—Ä–æ–¥—Å–∫–æ–µ':{},
            '–¥–æ–º —à–∞–ø—à–∏':{},
            '–¥—è—Ç–ª–æ–≤–æ':{},
            '–Ω–∞–±–µ—Ä–µ–∂–Ω–∞—è 3':{},
            '–Ω–∞ –≥–æ—Ä–µ / 141':{},
            '–Ω–∞–±–µ—Ä–µ–∂–Ω–∞—è 4':{},
            '–º–∞–ª—ã–π':{},
            '–±–æ–ª—å—à–æ–π':{},
            '–∑–µ–ª–µ–Ω—ã–π –º–∏–Ω–¥–∞–ª—å':{},
            '–¥–µ—Ä–µ–≤—è–Ω–Ω—ã–π':{},
            '–∫–∏—Ä–ø–∏—á–Ω—ã–π':{},
            '–∑–∞–º–æ–∫':{},
            '—Å—Ä—É–±':{},
            '–¥–≤–æ—Ä–µ—Ü':{},
            '—Ü–∞—Ä—Å–∫–∏–π':{},
            '—Å–æ—Å–Ω–æ–≤—ã–π':{},
            '–ø–∞–Ω–æ—Ä–∞–º–∞':{},
            '–∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã':{},
            '–±–∞–≤–∞—Ä–∏—è':{},
            '–∫–æ–Ω—Ç—Å–∞–Ω—Ç–∏–Ω–æ–≤–∫–∞':{},
            '–∫1':{},
            '–∫3':{},
            '–∫4':{},
            '–¥–æ–º':{},
            '—Ä—É—Å—Å–∫–∞—è':{},
            '–æ—Ö–æ—Ç–Ω–∏—á—å—è':{},
            '–±–µ—Ä–µ–≥':{},
            '–ø–∞—Ä–∫':{},
            '–∫–æ—â–∞–∫–æ–≤–æ':{},
            '–∑–∞–Ω—è—Ç–æ':{},
            '8 –∫–∞–∑–∞–Ω–∫–∞':{},
            '–±–∞–Ω–∫–µ—Ç–Ω—ã–π –∑–∞–ª':{},
            '1—Ä—ã—Ü–∞—Ä—Å–∫–∏–π':{},
            '2 vip':{},
            '3–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π':{},
            '4 –≤–æ—Å—Ç–æ—á–Ω—ã–π 1':{},
            '5–≤–æ—Å—Ç–æ—á–Ω—ã–π 2':{},
            '6—è–ø–æ–Ω—Å–∫–∏–π':{},
            '7–≥–æ—Å—Ç–µ–≤–æ–π':{},
            '–∞':{},
            '–±':{},
            '–≤':{},
            '–≥':{},
            '—Å–∞–ª–º–∞—á–∏':{},
            '–Ω–æ–≤—ã–π':{},
            '–º–∞–ª':{},
            '–º–∞–ª.–±–∞—Å':{},
            '—Å—Ä–µ–¥':{},
            '–±–æ–ª—å—à':{},
            '–∞ –º–∞–ª—ã–π':{},
            '–± —Å—Ä–µ–¥–Ω–∏–π':{},
            '–≤ –±–æ–ª—å—à–æ–π':{},
            '—á–∞–π–∫–∞1':{},
            '—á–∞–π–∫–∞2':{},
            '—É–ª –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–∫–∞ –Ω–æ–∫—Å–∏–Ω—Å–∫–∞—è':{},
            '–º–∏—Ä–∞ 141':{},
            '–±–µ–ª–æ–º–æ—Ä—Å–∫–∞—è 54':{},
            '–¥–∞—á–Ω–∞—è 128':{},
            '—É—Ç—Ä–µ–Ω–Ω—è—è 8–∞':{},
            '–º–∏—á—É—Ä–∏–Ω–∞117':{},
            '–±–æ–ª—å—à 58':{},
            '–º–∞–ª–±–∞—Å 60':{},
            '–º–∞–ª 56':{},
            '–Ω–æ–≤ 66':{},
            '–Ω–æ–≤—ã–π 66':{},
            '—Å—Ä–µ–¥ 54':{},
            '–õ–∏—Ç–≤–∏–Ω–æ–≤–∞ 1–∞':{}


        }

    # print(info)
    # print(message)
    for i in info1:
        message=message.replace(i, i.replace(" ", ""))
    message=message.replace("     ", " ")
    message=message.replace("    ", " ")
    message=message.replace("   ", " ")
    message=message.replace("  ", " ")
    # print(message)
    house=""
    month=""
    if len(info[phone])==1:
        for h in info[phone]:
            house=h
    if phone=='79600323247' or phone=='79178670299':
        for word in message.split(" "):
           
            if word not in info[phone]:
                if word.lower() not in months:
                    if word.isdigit():
                        if int(word)<=0 or int(word)>=32:
                            continue
                    else:
                        continue
                else:
                    month=word.lower()
                    continue
            if word in info[phone]:
                house=word
                continue
            else:
                if house!="":
                    # print(house)
                    if (word.lower() in months):
                    
                       
                        try:
                            print(len(info[phone][house][month]))
                        except:
                            info[phone][house][month]=[]
                            house=""
                    
                    else:
                        try:
                            
                          
                            try:
                                info[phone][house][month].append(word)
                            except:
                                info[phone][house][month]=[]
                                info[phone][house][month].append(word)
                        except:
                            print("Error")
    else:
        for word in message.split(" "):
            
            if word not in info[phone]:
                if word.lower() not in months:
                    if word.isdigit():
                        if int(word)<=0 or int(word)>=32:
                            continue
                    else:
                        continue
                else:
                    month=word.lower()
            if word in info[phone]:
                house=word
            else:
                if house!="":
                    if (word.lower() in months):
                    
                        # print(house)
                        # print(month)
                        try:
                            print(len(info[phone][house][month]))
                        except:
                            info[phone][house][month]=[]
                    
                    else:
                        try:
                            
                            
                            info[phone][house][month].append(word)
                        except:
                            pass
    # print(info)
    for h in info[phone]:
        if len(info[phone][h])!=0:
            print(h+':    ')
            for t in info[phone][h]:
                if(len(info[phone][h][t])>0):
                    print(str(t)+"             "+str(info[phone][h][t]))
    
    table(info, phone,wb)