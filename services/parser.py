from .table import table
import openpyxl
import requests
def parser(message, phone,wb):
    # f=open('text.txt', encoding="utf-8")
    # text=f.read()
    # f.close()
    text=message
    months=['—è–Ω–≤–∞—Ä—å','—Ñ–µ–≤—Ä–∞–ª—å','–º–∞—Ä—Ç','–∞–ø—Ä–µ–ª—å','–º–∞–π',
        '–∏—é–Ω—å','–∏—é–ª—å','–∞–≤–≥—É—Å—Ç','—Å–µ–Ω—Ç—è–±—Ä—å',
        '–æ–∫—Ç—è–±—Ä—å','–Ω–æ—è–±—Ä—å','–¥–µ–∫–∞–±—Ä—å',
    ]
    message=text.lower()
    for m in months:
        message=message.replace(m, ' ' +m+' ')
    message=message.replace("-", "")
    message=message.replace("–ó–∞–Ω—è—Ç—ã–µ –¥–∞—Ç—ã", " ")
    message=message.replace("–ó–∞–Ω—è—Ç—ã–µ –¥–∞—Ç—ã!", " ")
    message=message.replace("–∑–∞–Ω—è—Ç—ã–µ –¥–∞—Ç—ã!", " ")
    message=message.replace("!", " ")
    message=message.replace(".", "")
    message=message.replace("üè°", '')
    message=message.replace("‚úÖ", '')
    message=message.replace("‚õî", '')
    message=message.replace("\n", " ")
    message=message.replace(":", " ")
    message=message.replace(",", " ")
    message=message.replace("(", " ")
    message=message.replace(")", " ")
    message=message.replace("     ", " ")
    message=message.replace("    ", " ")
    message=message.replace("   ", " ")
    message=message.replace("  ", " ")
    message=message.replace("*", " ")
    new_formating_message=""
    info={
    '79053116753':
    {
        '–¥–æ–º–±–æ–≥–æ—Ä–æ–¥—Å–∫–æ–µ':{},
            '–¥–æ–º—à–∞–ø—à–∏':{},
    },
    '79063257387':
    {
        '–º–∞–ª—ã–π':{},
        '–±–æ–ª—å—à–æ–π':{},
    },
    '79600363975':
    {
        '–∑–µ–ª–µ–Ω—ã–π–º–∏–Ω–¥–∞–ª—å':{},
        '—Å–∞–ª–º–∞—á–∏':{},
    },
    '79377771034':
    {
        '–¥–µ—Ä–µ–≤—è–Ω–Ω—ã–π':{},
        '–∫–∏—Ä–ø–∏—á–Ω—ã–π':{},
    },
    '79047619866':
    {
        '–∑–∞–º–æ–∫':{},
        '—Å—Ä—É–±':{},
        '–¥–≤–æ—Ä–µ—Ü':{},
    },
    '79656012318':
    {
        '–±–∞–≤–∞—Ä–∏—è':{},
        '–∫–æ–Ωc—Ç–∞–Ω—Ç–∏–Ω–æ–≤–∫–∞':{},
        '–ø–∞–Ω–æ—Ä–∞–º–∞':{},
    },
    '79872974084':
    {
        '–∞–º–∞–ª—ã–π':{},
        '–±—Å—Ä–µ–¥–Ω–∏–π':{},
        '–≤–±–æ–ª—å—à–æ–π':{},
    },
    '79274226911':
    {
        '—á–∞–π–∫–∞1':{},
        '—á–∞–π–∫–∞2':{},
    },
    '79050212617':
    {
        '–¥–æ–º':{},
        '—Ä—É—Å—Å–∫–∞—è':{},
        '–æ—Ö–æ—Ç–Ω–∏—á—å—è':{},
        '–±–µ—Ä–µ–≥':{},
        '–ø–∞—Ä–∫':{},
    },
    '79872971476-1481554579@g.us':
    {
        '–∫1':{},
            '–∫3':{},
            '–∫4':{},
    },
    '79178767741-1419363809@g.us':
    {
        '–±–∞–Ω–∫–µ—Ç–Ω—ã–π–∑–∞–ª':{},
        '1—Ä—ã—Ü–∞—Ä—Å–∫–∏–π':{},
            '2vip':{},
            '3–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π':{},
            '4–≤–æ—Å—Ç–æ—á–Ω—ã–π1':{},
            '5–≤–æ—Å—Ç–æ—á–Ω—ã–π2':{},
            '6—è–ø–æ–Ω—Å–∫–∏–π':{},
            '7–≥–æ—Å—Ç–µ–≤–æ–π':{},
            '8–∫–∞–∑–∞–Ω–∫–∞':{},

    },
    '79655807679-1585037693@g.us':
    {
        '—Ü–∞—Ä—Å–∫–∏–π':{},
            '—Å–æ—Å–Ω–æ–≤—ã–π':{},
            '–ø–∞–Ω–æ—Ä–∞–º–∞':{},
            '–∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã':{},
             '–¥—è—Ç–ª–æ–≤–æ':{},
    },
    '79655888066-1485072828@g.us':
    {
        '3–Ω–æ–≤—ã–π':{},
        '–º–∞–ª—ã–π':{},
            '–±–æ–ª—å—à–æ–π':{},
    },
    '79655896555-1527783737@g.us':
    {
        '–º–∞–ª—ã–π':{},
            '–±–æ–ª—å—à–æ–π':{},
    },
    
    }
    # info={
        
    #         '–¥–æ–º–±—Ä–æ–≥–æ—Ä–æ–¥—Å–∫–æ–µ':{},
    #         '–¥–æ–º—à–∞–ø—à–∏':{},
    #         '–¥—è—Ç–ª–æ–≤–æ':{},
    #         '–Ω–∞–±–µ—Ä–µ–∂–Ω–∞—è3':{},
    #         '–Ω–∞–≥–æ—Ä–µ/141':{},
    #         '–Ω–∞–±–µ—Ä–µ–∂–Ω–∞—è4':{},
    #         '–º–∞–ª—ã–π':{},
    #         '–±–æ–ª—å—à–æ–π':{},
    #         '–∑–µ–ª–µ–Ω—ã–π–º–∏–Ω–¥–∞–ª—å':{},
    #         '–¥–µ—Ä–µ–≤—è–Ω–Ω—ã–π':{},
    #         '–∫–∏—Ä–ø–∏—á–Ω—ã–π':{},
    #         '–∑–∞–º–æ–∫':{},
    #         '—Å—Ä—É–±':{},
    #         '–¥–≤–æ—Ä–µ—Ü':{},
    #         '—Ü–∞—Ä—Å–∫–∏–π':{},
    #         '—Å–æ—Å–Ω–æ–≤—ã–π':{},
    #         '–ø–∞–Ω–æ—Ä–∞–º–∞':{},
    #         '–∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã':{},
    #         '–±–∞–≤–∞—Ä–∏—è':{},
    #         '–∫–æ–Ω—Ç—Å–∞–Ω—Ç–∏–Ω–æ–≤–∫–∞':{},
    #         '–∫1':{},
    #         '–∫3':{},
    #         '–∫4':{},
    #         '–¥–æ–º':{},
    #         '—Ä—É—Å—Å–∫–∞—è':{},
    #         '–æ—Ö–æ—Ç–Ω–∏—á—å—è':{},
    #         '–±–µ—Ä–µ–≥':{},
    #         '–ø–∞—Ä–∫':{},
    #         '–∫–æ—â–∞–∫–æ–≤–æ':{},
    #         '–∑–∞–Ω—è—Ç–æ':{},
    #         '8–∫–∞–∑–∞–Ω–∫–∞':{},
    #         '–±–∞–Ω–∫–µ—Ç–Ω—ã–π–∑–∞–ª':{},
    #         '1—Ä—ã—Ü–∞—Ä—Å–∫–∏–π':{},
    #         '2vip':{},
    #         '3–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π':{},
    #         '4–≤–æ—Å—Ç–æ—á–Ω—ã–π1':{},
    #         '5–≤–æ—Å—Ç–æ—á–Ω—ã–π2':{},
    #         '6—è–ø–æ–Ω—Å–∫–∏–π':{},
    #         '7–≥–æ—Å—Ç–µ–≤–æ–π':{},
    #         '–∞':{},
    #         '–±':{},
    #         '–≤':{},
    #         '–≥':{},
    #         '—Å–∞–ª–º–∞—á–∏':{},
    #         '–Ω–æ–≤—ã–π':{},
    #         '–º–∞–ª':{},
    #         '–º–∞–ª–±–∞—Å':{},
    #         '—Å—Ä–µ–¥':{},
    #         '–±–æ–ª—å—à':{},
    #         '–∞–º–∞–ª—ã–π':{},
    #         '–±—Å—Ä–µ–¥–Ω–∏–π':{},
    #         '–≤–±–æ–ª—å—à–æ–π':{},
    #         '—á–∞–π–∫–∞1':{},
    #         '—á–∞–π–∫–∞2':{},

    #     }

    info1={
        
            '–¥–æ–º –±–æ–≥–æ—Ä–æ–¥—Å–∫–æ–µ':{},
            '–¥–æ–º —à–∞–ø—à–∏':{},
            '–¥—è—Ç–ª–æ–≤–æ':{},
            '–Ω–∞–±–µ—Ä–µ–∂–Ω–∞—è 3':{},
            '–Ω–∞ –≥–æ—Ä–µ / 141':{},
            '–Ω–∞–±–µ—Ä–µ–∂–Ω–∞—è 4':{},
            '–º–∞–ª—ã–π':{},
            '–±–æ–ª—å—à–æ–π':{},
            '–∑–µ–ª–µ–Ω—ã–π –º–∏–Ω–¥–∞–ª—å':{},
            '–¥–µ—Ä–µ–≤—è–Ω–Ω—ã–π':{},
            '–∫–∏—Ä–ø–∏—á–Ω—ã–π':{},
            '–∑–∞–º–æ–∫':{},
            '—Å—Ä—É–±':{},
            '–¥–≤–æ—Ä–µ—Ü':{},
            '—Ü–∞—Ä—Å–∫–∏–π':{},
            '—Å–æ—Å–Ω–æ–≤—ã–π':{},
            '–ø–∞–Ω–æ—Ä–∞–º–∞':{},
            '–∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã':{},
            '–±–∞–≤–∞—Ä–∏—è':{},
            '–∫–æ–Ω—Ç—Å–∞–Ω—Ç–∏–Ω–æ–≤–∫–∞':{},
            '–∫1':{},
            '–∫3':{},
            '–∫4':{},
            '–¥–æ–º':{},
            '—Ä—É—Å—Å–∫–∞—è':{},
            '–æ—Ö–æ—Ç–Ω–∏—á—å—è':{},
            '–±–µ—Ä–µ–≥':{},
            '–ø–∞—Ä–∫':{},
            '–∫–æ—â–∞–∫–æ–≤–æ':{},
            '–∑–∞–Ω—è—Ç–æ':{},
            '8 –∫–∞–∑–∞–Ω–∫–∞':{},
            '–±–∞–Ω–∫–µ—Ç–Ω—ã–π –∑–∞–ª':{},
            '1—Ä—ã—Ü–∞—Ä—Å–∫–∏–π':{},
            '2 vip':{},
            '3–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π':{},
            '4 –≤–æ—Å—Ç–æ—á–Ω—ã–π 1':{},
            '5–≤–æ—Å—Ç–æ—á–Ω—ã–π 2':{},
            '6—è–ø–æ–Ω—Å–∫–∏–π':{},
            '7–≥–æ—Å—Ç–µ–≤–æ–π':{},
            '–∞':{},
            '–±':{},
            '–≤':{},
            '–≥':{},
            '—Å–∞–ª–º–∞—á–∏':{},
            '–Ω–æ–≤—ã–π':{},
            '–º–∞–ª':{},
            '–º–∞–ª.–±–∞—Å':{},
            '—Å—Ä–µ–¥':{},
            '–±–æ–ª—å—à':{},
            '–∞ –º–∞–ª—ã–π':{},
            '–± —Å—Ä–µ–¥–Ω–∏–π':{},
            '–≤ –±–æ–ª—å—à–æ–π':{},
            '—á–∞–π–∫–∞1':{},
            '—á–∞–π–∫–∞2':{},

        }

    # print(info)
    # print(message)
    for i in info1:
        message=message.replace(i, i.replace(" ", ""))
    message=message.replace("     ", " ")
    message=message.replace("    ", " ")
    message=message.replace("   ", " ")
    message=message.replace("  ", " ")
    # print(message)
    house=""
    month=""
    for word in message.split(" "):
             
        if word not in info[phone]:
            if word.lower() not in months:
                if word.isdigit():
                    if int(word)<=0 or int(word)>=32:
                        continue
                else:
                    continue
            else:
                month=word.lower()
        if word in info[phone]:
            house=word
        else:
            if house!="":
                if (word.lower() in months):
                
                    # print(house)
                    # print(month)
                    try:
                        print(len(info[phone][house][month]))
                    except:
                        info[phone][house][month]=[]
                
                else:
                    try:
                        
                        
                        info[phone][house][month].append(word)
                    except:
                        pass
    # print(info)
    for h in info[phone]:
        if len(info[phone][h])!=0:
            print(h+':    ')
            for t in info[phone][h]:
                if(len(info[phone][h][t])>0):
                    print(str(t)+"             "+str(info[phone][h][t]))
    
    table(info, phone,wb)